- name: install docker and add a registry name to the list of insecure registry list

  hosts: all
  vars:
      insecure_registries: "empty"  #insecure
  gather_facts: no
  become: yes

  tasks:

    - name: install docker
      package:
        name: docker
        state: present

    - name: fail if registry name is not set
      fail:
        msg: "Please mention registry name - reg_name"
      when:
        - insecure_registries == "empty"


    - name: add registry name to the list of insecure registry
      shell: >
             echo -e "{\n\t\"insecure-registries\" : [ \"{{ reg_name }}\" ]\n}" > /etc/docker/daemon.json
             
    - name: restart docker
      service:
         name: docker
         state: restarted
         enabled: yes
